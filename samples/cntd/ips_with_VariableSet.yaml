######
# IMP: write in reverse order of dependencies to see expected behaviour(to avoid missing CRD errors) i.e. independent CRDs should come first
# example: ThreatConfig CRD should come after ThreatPolicy and EventConfiguration CRDs as it is dependent on them
######

# Variables represent values commonly used in intrusion rules to 
# identify source and destination IP addresses and ports.

# Intrusion policies and variable sets are used to configure 
# intrusion detection and prevention configurations in snort that inspect 
# traffic for security violations and, in inline deployments, can block 
# malicious traffic. A variable set that you pair with the 
# intrusion policy allows you to accurately reflect your home and external 
# networks and, as appropriate, the servers on your network.

apiVersion: cntd.cisco.com/v1
kind: IntrusionPolicy
metadata:
  name: my-ips-policy
  namespace: sfcn-system
spec:
  type: connectivity-ips
  mode: Inline
  disabledRules:
    - gid: 1
      sid: 57912
      action: "Block"
    - gid: 1
      sid: 37732
      action: "Block"
  treatBlockAsReject: false
---
apiVersion: cntd.cisco.com/v1
kind: IntrusionPolicy
metadata:
  name: my-ips-policy2
  namespace: sfcn-system
spec:
  type: security-ips
  mode: Inline
  addedRules:
    - gid: 1
      sid: 57912
      action: "Block"
  treatBlockAsReject: false
---
apiVersion: cntd.cisco.com/v1
kind: VariableSet
metadata:
  name: my-var-set
  namespace: sfcn-system
spec:
  customVariables:
    HTTP_PORTS: "80 8080"
    FTP_PORTS: "500 21"
  nets:
    DNS_SERVERS: "192.168.0.0/16"
    EXTERNAL_NET: "!10.30.40.50,10.30.40.0/24"
    HOME_NET: "192.168.0.0/16"
    HTTP_SERVERS: "192.168.0.0/16"
    SIP_SERVERS: "192.168.0.0/16"
    SMTP_SERVERS: "192.168.0.0/16"
    SNMP_SERVERS: "192.168.0.0/16"
    SQL_SERVERS: "192.168.0.0/16"
    SSH_SERVERS: "192.168.0.0/16"
    TELNET_SERVERS: "192.168.0.0/16"
  ports:
    FILE_DATA_PORTS: "10000,10080,10100,10250,10255,10297,10443,110,11371,1158,1194,1212,1220,12601,1270,13014,1414,1422,143,14592,1533,15489,15672,1581,16000,16992,16993,16994,16995,17000,1719,1720,1741,1801,18081,1812,1830,1942,19980,2231,2301,23472,2375,2381,2484,2578,2809,2869,2980,29991,3000,30007,30018,3029,3037,3057,30888,311,3128,33300,34412,3443,34443,34444,3507,36,36099,3702,383,4000,40007,41080,4343,443,44449,4592,4848,49152,49153,5000,50000,50002,50452,5054,5060,5061,5117,51423,5222,5250,53331,5416,5443,54444,5450,5480,55252,555,5555,55555,5600,5601,56712,5814,5894,591,593,5984,5985,5986,6080,6173,623,631,664,666,6767,6988,7000,7001,7005,7070,7071,7080,7144,7145,7180,7181,7510,7770,7777,7778,7779,80,8000,8001,8008,801,8014,8015,8020,8028,8040,8060,808,8080,8081,8082,8085,8088,8090,8095,81,8118,8123,8161,818,8180,8181,8182,82,8222,8243,8280,83,8300,8333,8344,8393,84,8400,8443,8484,85,8500,8509,86,8694,87,8787,88,8800,8852,8880,8888,8899,89,8983,90,9000,9001,9002,901,9050,9060,9080,9090,9091,9111,9200,9201,9290,9443,9447,9700,9710,972,9788,9830,9850,9999"
    FTP_PORTS: "21,2100,3535"
    GTP_PORTS: "2123,2152,3386"
    HTTP_PORTS: "10000,10080,10100,10250,10255,10297,10443,11371,1158,1194,1212,1220,12601,1270,13014,1414,1422,14592,1533,15489,15672,1581,16000,16992,16993,16994,16995,17000,1719,1720,1741,1801,18081,1812,1830,1942,19980,2231,2301,23472,2375,2381,2484,2578,2809,2869,2980,29991,3000,30007,30018,3029,3037,3057,30888,311,3128,33300,34412,3443,34443,34444,3507,36,36099,3702,383,4000,40007,41080,4343,443,44449,4592,4848,49152,49153,5000,50000,50002,50452,5054,5060,5061,5117,51423,5222,5250,53331,5416,5443,54444,5450,5480,55252,555,5555,55555,5600,5601,56712,5814,5894,591,593,5984,5985,5986,6080,6173,623,631,664,666,6767,6988,7000,7001,7005,7070,7071,7080,7144,7145,7180,7181,7510,7770,7777,7778,7779,80,8000,8001,8008,801,8014,8015,8020,8028,8040,8060,808,8080,8081,8082,8085,8088,8090,8095,81,8118,8123,8161,818,8180,8181,8182,82,8222,8243,8280,83,8300,8333,8344,8393,84,8400,8443,8484,85,8500,8509,86,8694,87,8787,88,8800,8852,8880,8888,8899,89,8983,90,9000,9001,9002,901,9050,9060,9080,9090,9091,9111,9200,9201,9290,9443,9447,9700,9710,972,9788,9830,9850,9999"
    ORACLE_PORTS: "any"
    SHELLCODE_PORTS: "!80"
    SIP_PORTS: "5060,5061,5600"
    SSH_PORTS: "22"
---
apiVersion: cntd.cisco.com/v1
kind: VariableSet
metadata:
  name: my-var-set2
  namespace: sfcn-system
spec:
  customVariables:
    HTTP_PORTS: "80 8081"
    FTP_PORTS: "500 21"
  nets:
    SMTP_SERVERS: "192.168.0.0/16"
    SNMP_SERVERS: "192.168.0.0/16"
    SQL_SERVERS: "192.168.0.0/16"
    SSH_SERVERS: "192.168.0.0/16"
    TELNET_SERVERS: "192.168.0.0/16"
  ports:
    SHELLCODE_PORTS: "!80"
    SIP_PORTS: "5060,5061,5600"
    SSH_PORTS: "22"
    HTTP_PORTS: "10000,10080,10100,10250,10255,10297,10443,11371,1158,1194,1212,1220,12601,1270,13014,1414,1422,14592,1533,15489,15672,1581,16000,16992,16993,16994,16995,17000,1719,1720,1741,1801,18081,1812,1830,1942,19980,2231,2301,23472,2375,2381,2484,2578,2809,2869,2980,29991,3000,30007,30018,3029,3037,3057,30888,311,3128,33300,34412,3443,34443,34444,3507,36,36099,3702,383,4000,40007,41080,4343,443,44449,4592,4848,49152,49153,5000,50000,50002,50452,5054,5060,5061,5117,51423,5222,5250,53331,5416,5443,54444,5450,5480,55252,555,5555,55555,5600,5601,56712,5814,5894,591,593,5984,5985,5986,6080,6173,623,631,664,666,6767,6988,7000,7001,7005,7070,7071,7080,7144,7145,7180,7181,7510,7770,7777,7778,7779,80,8000,8001,8008,801,8014,8015,8020,8028,8040,8060,808,8080,8081,8082,8085,8088,8090,8095,81,8118,8123,8161,818,8180,8181,8182,82,8222,8243,8280,83,8300,8333,8344,8393,84,8400,8443,8484,85,8500,8509,86,8694,87,8787,88,8800,8852,8880,8888,8899,89,8983,90,9000,9001,9002,901,9050,9060,9080,9090,9091,9111,9200,9201,9290,9443,9447,9700,9710,972,9788,9830,9850,9999"
    FTP_PORTS: "21,2100,3535"
---
apiVersion: cntd.cisco.com/v1
kind: LoggingDestination
metadata:
  name: my-logging-dest
  namespace: sfcn-system
spec:
  syslog:
    syslogServer:
      hostname: 172.16.235.104
      port: 514
    severity: AlertLog
    facility: 10
---
apiVersion: cntd.cisco.com/v1
kind: LoggingDestination
metadata:
  name: my-ips-logging-dest
  namespace: sfcn-system
spec:
  syslog:
    syslogServer:
      hostname: 172.16.235.104
      port: 514
    severity: AlertLog
    facility: 10
---
apiVersion: cntd.cisco.com/v1
kind: EventConfiguration
metadata:
  name: my-event-config
  namespace: sfcn-system
spec:
  consumerConfiguration:
    sendEventsSSE: false
---
apiVersion: cntd.cisco.com/v1
kind: ThreatPolicy
metadata:
  name: my-threat-policy
  namespace: sfcn-system
spec:
  rules:
    - attributes:
        Name: "networkrule_ips"
      action: Inspect
      binders:
        - destinationPorts:
            - port: 443
              protocol: 6
      id:
        id : "2213"
      intrusionPolicy: my-ips-policy2
      logAction: LogFlowBoth
      variableSet: my-var-set2
  defaultLoggingDest: my-logging-dest
  intrusionEventLogging:
    sendEvents: false
    loggingDestination: my-ips-logging-dest
  defaultIntrusionPolicy: my-ips-policy
  intrusionRuleOptions:
    - gid: 1
      sid: 29456
      alertOptions:
        threshold:
          type: "Both"
          track: "By_dst"
          count: 20
          seconds: 60
        suppression:
          sourceNetworks:
            - ip: "1.1.1.1"
              netmask: 32
          destinationNetworks:
            - ip: "1.1.1.2"
              netmask: 24
  defaultVariableSet: "my-var-set"
---
apiVersion: cntd.cisco.com/v1
kind: ThreatConfig
metadata:
  name: my-config
  namespace: sfcn-system
spec:
  threatPolicy: my-threat-policy
  eventConfiguration: my-event-config
---
apiVersion: cntd.cisco.com/v1
kind: ThreatFeedSchedule
metadata:
  name: sfcn-system-feed-schedule
  namespace: sfcn-system
spec:
  scheduleConfigs:
    - jobType: 'LSPUpdate'
      schedule:
        dayOfWeek: '3'
        month: '*'
        dayOfMonth: '1'
        hour: '01'
        minute: '01'